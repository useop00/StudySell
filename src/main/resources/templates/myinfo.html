<!DOCTYPE html>
<html   xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns="http://www.w3.org/1999/html"
        layout:decorate="~{layouts/layout1}">

<th:block layout:fragment="script">

   <script th:inline="javascript">
      $(document).ready(function(){
         var errorMessage = [[${errorMessage}]];
         if(errorMessage != null){
            alert(errorMessage);
         }

         bindDomEvent();

      });

      function bindDomEvent(){
         $(".custom-file-input").on("change", function() {
            var fileName = $(this).val().split("\\").pop();  //이미지 파일명
            var fileExt = fileName.substring(fileName.lastIndexOf(".")+1); // 확장자 추출
            fileExt = fileExt.toLowerCase(); //소문자 변환

            if(fileExt != "jpg" && fileExt != "jpeg" && fileExt != "gif" && fileExt != "png" && fileExt != "bmp"){
               alert("이미지 파일만 등록이 가능합니다.");
               return;
            }

            $(this).siblings(".custom-file-label").html(fileName);
         });
      }
      $(document).on('click', '.btn-delete', function(e) {
         e.preventDefault(); // 기본 이벤트를 방지
         var itemId = $(this).data('itemid'); // 데이터 속성에서 상품 ID 추출

         if(confirm('해당 상품을 삭제하시겠습니까?')) {
            $.ajax({
               url: '/user/item/' + itemId + '/delete', // 삭제 처리를 위한 URL
               type: 'POST', // HTTP 메소드를 POST로 변경
               success: function(result) {
                  location.reload();
               }
            });
         }
      });
   </script>

</th:block>
<th:block layout:fragment="css">

</th:block>
<div layout:fragment="content">
   <form role="form" method="post" enctype="multipart/form-data" th:object="${items}" class="container mt-5">
      <p>이름 : <span th:text="${#authentication.name}"></span></p>
      <a th:href="@{myinfo/items}">내 상품 목록</a>
      <div class="row">
         <!-- 아이템 목록을 반복해서 보여줌 -->
         <div th:each="item : ${items}" class="col-md-4 mt-3">
            <div class="card">
               <!-- 아이템 정보 -->
               <div class="card-body">
                  <h5 class="card-title" th:text="${item.itemName}">Item Name</h5>
                  <p class="card-text" th:text="${item.description}">Description</p>
                  <p class="card-text"><strong>Price:</strong> <span th:text="${item.price}">가격</span></p>
                  <!-- 수정 버튼, 각 아이템의 ID를 기반으로 수정 페이지로 연결 -->
                  <a th:if="${not #strings.isEmpty(item.id)}" th:href="@{/user/item/{id}(id=${item.id})}" class="btn btn-primary">수정</a>
                  <button type="button" th:attr="data-itemId=${item.id}" class="btn btn-success btn-delete">삭제</button>

               </div>
            </div>
         </div>
      </div>
      <a th:href="@{myinfo/rooms}">My Chat Rooms</a>
<!--      <ul>-->
<!--         <li th:each="room : ${rooms}">-->
<!--            <a th:href="@{/item/room/{id}(id=${room.id})}" th:text="${room.name}"></a>-->
<!--            <form th:action="@{/item/room/{id}/leave(id=${room.id})}" method="post" style="display:inline;">-->
<!--               <button type="submit">Leave</button>-->
<!--            </form>-->
<!--         </li>-->
<!--      </ul>-->
   </form>
</div>
</html>